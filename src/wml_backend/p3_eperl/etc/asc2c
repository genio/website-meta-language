#!/usr/bin/env perl
##
##  asc2c -- convert an ASCII file into a statically initialised
##           C array of characters
##
##  Copyright (c) Ralf S. Engelschall, All Rights Reserved.
##

use strict;
use warnings;
use autodie;

my ( $filein, $fileout, $name ) = @ARGV;

if ( @ARGV != 3 )
{
    die "Usage: $0 ascii-file c-file buffer-name\n";
}

open( my $IN, '<', $filein );

#open(OUTH, ">$fileout.h");
open( OUTC, '>', "$fileout.c" );

print OUTC "/* $filein.c -- automatically generated by asc2c */\n";
print OUTC "\n";
print OUTC "char *$name = \\\n";

while ( my $l = <$IN> )
{
    #next if m|^[ \t]*$|;
    #next if m|^[ \t]*#.*$|;
    chomp $l;
    $l =~ s|\\|\\\\|g;
    $l =~ s|\"|\\\"|g;
    printf( OUTC "\"%s\\n\"\\\n", $l );
}

print OUTC ";\n";
print OUTC "\n";
print OUTC "/*EOF*/\n";

my $filename = "$fileout.h";
$filename =~ tr|a-z.|A-Z_|;

#print OUTH "/* $fileout.h -- automatically generated by asc2c */\n";
#print OUTH "#ifndef __$filename\n";
#print OUTH "#define __$filename\n";
#print OUTH "\n";
#print OUTH "extern char *$name;\n";
#print OUTH "\n";
#print OUTH "#endif /* __$filename */\n";

close($IN);

#close(OUTH);
close(OUTC);

##EOF##
